<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Appointment Scheduler</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-ui-dist@1.12.1/jquery-ui.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery-ui-dist@1.12.1/jquery-ui.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">


</head>

<body class="bg-gray-100 p-8">
  <div id="app" class="container mx-auto">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Left Column -->
      <div class="space-y-8">
        <!-- Appointment Section -->
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-2xl font-bold mb-4">Appointment</h2>
          <div class="grid grid-cols-3 gap-4 mb-4">
            <input type="text" id="date" class="border rounded p-2 datepicker" placeholder="Date">
            <input type="text" id="name" class="border rounded p-2" placeholder="Name">
            <select id="provider" class="border rounded p-2 select2">
              <option value="">Select Provider</option>
            </select>
          </div>
          <div class="grid grid-cols-2 gap-4 mb-4">
            <input type="text" id="note" class="border rounded p-2" placeholder="Note">
            <input type="text" id="summary" class="border rounded p-2" placeholder="Summary">
          </div>
          <button onclick="getSlots()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Get
            Slots</button>
          <div id="slots-container" class="grid grid-cols-3 gap-4 mt-4" style="display: none;">
            <!-- Slots will appear here dynamically -->
          </div>
          <button onclick="createSlot()"
            class="mt-4 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Create Slot</button>
        </div>

        <!-- All Appointments Section -->
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-2xl font-bold mb-4">All Appointments</h2>
          <div id="appointments-container" class="space-y-4">
            <!-- Appointments will appear here dynamically -->
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div class="space-y-8">
        <!-- Provider Section -->
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-2xl font-bold mb-4">Provider</h2>
          <input type="text" id="provider-name" class="border rounded p-2 w-full mb-4" placeholder="Name">
          <button onclick="createProvider()"
            class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full">Create</button>
        </div>

        <!-- Availability Section -->
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-2xl font-bold mb-4">Availability</h2>
          <select id="select-provider" class="border rounded p-2 w-full mb-4 select2">
            <option>Select Provider</option>
          </select>
          <div class="grid grid-cols-3 gap-4 mb-4">
            <input type="text" id="availability-date" class="border rounded p-2 datepicker" placeholder="Date">
          </div>
          <div id="slots-section">
            <!-- Multiple slots will be added here -->
            <div class="slot-inputs mb-4">
              <input type="text" class="start-time timepicker border rounded p-2" placeholder="Start Time">
              <input type="text" class="end-time timepicker border rounded p-2" placeholder="End Time">
              <button class="remove-slot bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Remove</button>
            </div>
          </div>
          <button onclick="addNewSlot()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full">Add
            Slot</button>
          <button onclick="addAvailability()"
            class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 w-full">Save Availability</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let providers = [];
    let availability = {};
    let selectedSlot = null;

    $(document).ready(function () {
      // Initialize Select2 for dropdowns
      $('#provider').select2();
      $('#select-provider').select2();

      // Initialize Datepicker for date inputs
      $('.datepicker').datepicker();

      // Initialize Timepicker for start and end time inputs
      $('.timepicker').timepicker({
        timeFormat: 'h:mm p',
        interval: 60,
        minTime: '10',
        maxTime: '6:00pm',
        defaultTime: '11',
        startTime: '10:00',
        dynamic: false,
        dropdown: true,
        scrollbar: true
      });


      // Automatically add an example provider for testing
      createProvider('Test Provider');
    });

    function createProvider(providerName) {
      if (providerName) {
        providers.push(providerName);
        const providerSelect = document.getElementById('select-provider');
        const option = document.createElement('option');
        option.value = providerName;
        option.textContent = providerName;
        providerSelect.appendChild(option);
      }
    }

    function addNewSlot() {
      const slotSection = document.getElementById('slots-section');
      const newSlot = document.createElement('div');
      newSlot.classList.add('slot-inputs', 'mb-4');
      newSlot.innerHTML = `
                <input type="text" class="start-time timepicker border rounded p-2" placeholder="Start Time">
                <input type="text" class="end-time timepicker border rounded p-2" placeholder="End Time">
                <button class="remove-slot bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Remove</button>
            `;
      slotSection.appendChild(newSlot);

      // Initialize timepicker for new slots
      $('.start-time,.end-time').timepicker({
        timeFormat: 'h:mm p',
        interval: 60,
        minTime: '10',
        maxTime: '6:00pm',
        defaultTime: '11',
        startTime: '10:00',
        dynamic: false,
        dropdown: true,
        scrollbar: true
      });



      // Add functionality to remove slot
      const removeButton = newSlot.querySelector('.remove-slot');
      removeButton.addEventListener('click', () => {
        newSlot.remove();
      });
    }

    function addAvailability() {
      const provider = document.getElementById('select-provider').value;
      const date = document.getElementById('availability-date').value;
      const slotElements = document.querySelectorAll('.slot-inputs');
      const slots = [];

      if (!provider || !date || slotElements.length === 0) {
        alert('Please fill out all fields.');
        return;
      }

      slotElements.forEach(slotElement => {
        const startTime = slotElement.querySelector('.start-time').value;
        const endTime = slotElement.querySelector('.end-time').value;

        if (startTime && endTime) {
          slots.push({ startTime, endTime });
        }
      });

      if (slots.length === 0) {
        alert('Please add at least one time slot.');
        return;
      }

      const availabilityKey = `${provider}-${date}`;
      if (!availability[availabilityKey]) {
        availability[availabilityKey] = [];
      }

      availability[availabilityKey] = availability[availabilityKey].concat(slots);

      alert(`Availability added for ${provider} on ${date}`);

      // Clear the inputs after saving
      document.getElementById('availability-date').value = ''; // Clear date input
      document.querySelectorAll('.start-time').forEach(input => input.value = ''); // Clear time inputs
      document.querySelectorAll('.end-time').forEach(input => input.value = ''); // Clear time inputs
    }

    function getSlots() {
      const date = document.getElementById('date').value;
      const provider = document.getElementById('provider').value;
      const availabilityKey = `${provider}-${date}`;

      const slotsContainer = document.getElementById('slots-container');
      slotsContainer.innerHTML = '';

      if (availability[availabilityKey]) {
        availability[availabilityKey].forEach((slot, index) => {
          const slotDiv = document.createElement('div');
          slotDiv.classList.add('bg-gray-200', 'p-4', 'rounded', 'cursor-pointer');
          slotDiv.textContent = `From: ${slot.startTime} To: ${slot.endTime}`;
          slotDiv.onclick = function () { selectSlot(index); };
          slotsContainer.appendChild(slotDiv);
        });
        slotsContainer.style.display = 'grid';
      } else {
        alert('No available slots for this provider on this date.');
      }
    }

    function selectSlot(index) {
      selectedSlot = index;
      alert(`Slot selected: ${JSON.stringify(availability[`${document.getElementById('provider').value}-${document.getElementById('date').value}`][index])}`);
    }

    function createSlot() {
      if (selectedSlot !== null) {
        const selected = availability[`${document.getElementById('provider').value}-${document.getElementById('date').value}`][selectedSlot];
        document.getElementById('appointments-container').innerHTML += `
                    <div class="bg-gray-200 p-4 rounded">
                        <p><strong>Provider:</strong> ${document.getElementById('provider').value}</p>
                        <p><strong>Date:</strong> ${document.getElementById('date').value}</p>
                        <p><strong>From:</strong> ${selected.startTime}</p>
                        <p><strong>To:</strong> ${selected.endTime}</p>
                    </div>
                `;
      } else {
        alert('Please select a time slot first.');
      }
    }
  </script>
</body>

</html>